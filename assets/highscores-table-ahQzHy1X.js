import{m as u,j as l,o as m,k as n,n as f,p as d,l as _,r as b,b as w,y as a}from"./vendor-tJNv_qKg.js";import{d as $}from"./index-PBFosM17.js";let S=(o=21)=>crypto.getRandomValues(new Uint8Array(o)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");const D="https://jsonstorage.net/api/items/92724162-5354-4099-9b3a-112dfa90706a";class M{storageURI=D;highscores;add(e,s,t){let c={id:S(),date:new Date,time:e,player:s,difficulty:t};return this.request().pipe(u(r=>(r[t].push(c),r[t]=this.sortList(r[t]),r[t]=this.rankList(r[t]),c=this.findId(r,c.id,t),r.updated=new Date,this.send(r))),l(r=>({entry:c,highscores:{list:r[t].slice(0,10),updated:r.updated}})))}get(e,s,t=10){return this.getHighscores().pipe(l(c=>{const r={list:c[e],updated:c.updated};return s&&s.length>0&&(s=s.toLowerCase(),r.list=r.list.filter(h=>h.player.toLowerCase()===s)),typeof t=="number"&&t>0&&(r.list=r.list.slice(0,t)),r}))}getHighscores(){return this.highscores?m(this.highscores):this.request()}request(){return n(fetch(this.storageURI).then(async e=>e.json())).pipe(l(e=>this.decompress(e)),f(e=>{this.highscores=e}))}send(e){return n(fetch(this.storageURI,{headers:{"Content-Type":"application/json;charset=utf-8"},method:"put",body:JSON.stringify(this.compress(e))})).pipe(l(()=>(this.highscores=e,e)))}findId(e,s,t){return e[t].find(({id:c})=>c===s)}sortList(e){return e.sort((s,t)=>{const c=d(s.time,t.time);return c===0?d(s.date,t.date):c})}rankList(e){return e.map((s,t)=>({...s,rank:t+1}))}compress(e){return[_.compressToUTF16(JSON.stringify(e))]}decompress([e]){return Object.entries(JSON.parse(_.decompressFromUTF16(e))).reduce((s,[t,c])=>({...s,[t]:t==="updated"?new Date(c):c.map(r=>({...r,date:new Date(r.date)}))}),{})}}const O=new M,U=Object.entries($).reduce((o,[e,s])=>({...o,[s]:e}),{});function L(o){return U[o]}function i(o,e=2){const s=`${o}`,t=Math.max(0,e-s.length);return`${"0".repeat(t)}${s}`}function T(o,e=!0){const s=Math.floor(o/6e4);o-=s*6e4;const t=Math.floor(o/1e3);return`${i(s)}:${i(t)}${e?`:${i(o-t*1e3,3)}`:""}`}function j(o,e=!0){return b(o,`dd.MM.yyyy${e?" HH:mm:ss":""}`)}class R extends w{render({list:e,highlight:s}){return a("table",{class:"c-highscores-table"},a("thead",null,a("tr",{class:"c-highscores-table__head-row"},a("th",{class:"c-highscores-table__head-cell c-highscores-table__head-cell--rank"},"#"),a("th",{class:"c-highscores-table__head-cell c-highscores-table__head-cell--name"},"Name"),a("th",{class:"c-highscores-table__head-cell c-highscores-table__head-cell--difficulty"},"Difficulty"),a("th",{class:"c-highscores-table__head-cell c-highscores-table__head-cell--time"},"Time"))),a("tbody",null,(e||[]).map(({id:t,rank:c,player:r,difficulty:h,time:g,date:p})=>a("tr",{title:`${r} üèÜ ${j(p)}`,class:`c-highscores-table__row ${t===s?"c-highscores-table__row--highlight":""}`},a("td",{class:"c-highscores-table__cell c-highscores-table__cell--rank"},c),a("td",{class:"c-highscores-table__cell c-highscores-table__cell--name"},r),a("td",{class:"c-highscores-table__cell c-highscores-table__cell--difficulty"},L(h)),a("td",{class:"c-highscores-table__cell c-highscores-table__cell--time"},T(g))))),!e||e.length===0?a("tfoot",null,a("tr",{class:"c-highscores-table__foot-row"},e===null?a("td",{colSpan:4,class:"c-highscores-table__foot-cell c-highscores-table__foot-cell--error"},"Error loading highscores."):e===void 0?a("td",{colSpan:4,class:"c-highscores-table__foot-cell c-highscores-table__foot-cell--loading"},"Loading..."):a("td",{colSpan:4,class:"c-highscores-table__foot-cell c-highscores-table__foot-cell--empty"},"No entries found."))):"")}}export{R as H,L as a,j as b,T as f,O as h};
//# sourceMappingURL=highscores-table-ahQzHy1X.js.map
